# 系统架构师设计教程(清华)
## 绪论
软件架构定义如下：系统软件架构是关于软件系统的结构、行为和属性的高级抽象。在描述阶段，其对象是直接构成系统的抽象组件以及各个组件直接的连接规则，
特别是相对细致地描述组件之间的通讯。在实现阶段，这些抽象组件被细化为实际的组件，比如具体的类或对象。软件系统架构不仅指定系统软件的组织结构和拓扑结构，
而且显示了系统需求和构成组件之间的对应关系，包括设计决策的基本方法和基本原则。

著名企业架构框架：TOGAF The Open Group Architecture Framework  

架构师类别：业务架构师（Business Architect）、技术架构师(Technology Architect)、主题领域架构师(Domain architect)、项目架构师、系统架构师(System Architect)

系统架构师定义：系统架构师是系统或产业线的设计负责人，一个负责理解和管理并最终确认和评估非功能性系统需求（如软件的可维护性、性能、复用性、可靠性、有效性和可测试性等）
给出开发规范，搭建系统实现核心架构，对整体软件架构、关键构件、接口进行总体设计并澄清关键技术细节的高级技术人员。

系统架构定位：基于环境和资源的系统技术实现。
项目管理师：人员、资金、设备。
系统分析师：主要业务需求分析、系统需求分析、可行性分析等

系统架构师知识结构
* 战略规划能力
* 业务流程建模能力
* 业务建模能力
* 信息数据架构能力
* 技术架构选择和实现能力
* 应用系统的解决和实现能力
* 基础IT知识及基础设施、资源调配能力
* 信息安全技术支持与管理保障能力
* IT审计、治理与基本需求分析、获取能力
* 面向系统软件可靠性与系统生命周期的质量保障服务能力

架构师认证
* UC Irvine
* CMU/SEI
* iCMG

## 计算机与网络基础知识
计算机由硬件和软件组成。软件分为系统软件和应用软件。

系统软件支持应用软件运行，为用户开发应用软件提供平台，用户可以使用它，不可以修改它。系统软件有操作系统、语言处理程序等。

应用软件：用户利用计算机软、硬件资源为某一专门的应用目的而开发的软件，例如表格、计算器等。

### 操作系统原理、类型和结构
操作系统定义：硬件资源包括在预处理、存储器、和输入输出等物理设备。软件资源是以文件形式保存在存储器上的程序和数据等信息。
操作系统既能有效地组织和管理系统中各种软、硬件资源，合理地组织计算机系统的工作流程，又能控制程序性的执行，并且为用户使用计算机体
提供一种良好的环境和友好的接口，从而是用户充分利用计算机资源，提高系统效率。

操作系统分类：单用户操作系统和批处理操作系统，分时操作系统和实时操作系统；网络操作系统和分布式操作系统；以及嵌入式操作系统

系统特性：并发性、共享性、虚拟性、不确定性

系统功能：进程管理、文件管理、存储管理、设备管理、作业管理

### 处理机和进程管理
进程（process）是资源分配和独立运行的基本单位。研究进程实质上是研究系统中诸多进程之间的并发性以及进程之间的相互制约性。

进程定义：是程序的一次执行，改程序可以和其他程序并发执行。进程通常由程序、数据、进程控制块（Process Control Block,PCB）组成,PCB进程存在唯一标识。

程序和进程区别：陈旭静态指令序列，进程是为执行该程序的线程而保留的资源集合。

进程分为：系统进行、用户进行；父进程和子进程。

#### 进程状态转换和控制
三态模型：就绪、运行、阻塞

三态转换关系：![Image text](https://raw.githubusercontent.com/DEAN-Lee/img-rep/master/system_architecture/Snipaste_2020-11-18_14-16-49.png)

五态模型：新建、就绪、运行、阻塞、终止

五态进程态：![Image text](https://raw.githubusercontent.com/DEAN-Lee/img-rep/master/system_architecture/Snipaste_2020-11-18_14-17-07.png)

五态进程态和转换：![Image text](https://raw.githubusercontent.com/DEAN-Lee/img-rep/master/system_architecture/Snipaste_2020-11-18_14-17-31.png)

进程控制：对系统中所有进程从创建到消亡的全过程实施有效的控制。主要控制工作时系统内核完成的。进程控制是通过进程控制原语实现，进程控制原语主要创建原语、撤销原语、挂起原语、阻塞原语、唤醒原语。

#### 进程互斥与同步以及P、V操作
* 进程同步

    异步环境下的一组并发进程之间互发消息、相互合作、相互等待，使得各进程按一定的速度执行的过程称为进程同步，在异步环境下各个进程按照一定顺序和速度执行。
  
* 进程互斥
    
    并发进程的一个或多个程序段，因共享某一个公有资源而使得它们必须以一个不允许交叉的顺序执行。互斥进程保证临界资源在某一时刻只被一个进程访问。
    
* 临界资源

    系统中有些资源可以供多个进程同时使用，有些资源一次只能供一个进程使用，称为临界资源（Critical Resource,CR）.
    
* 临界资源管理原则

    临界区（Critical Section,CS)是进程中对临界资源实施操作的那段程序。互斥临界区管理的原则是有空则进、无空则等、有限等待、让权等待。
    
* 信号量机制

    1965年提出、卓有成效的进程同步与互斥的工具
    
* 整型信号量和PV操作

    信号量一个整型变量，根据控制对象的不同赋不同的值。信号量分为：
    
        公用信号量：实现进程间的互斥，初始值=1或资源的数目
        私用信号量：实现进程间的同步，初始值=0或某个正整数。
    
    信号量S物理意义：S>=0表示某资源的可用数，S<0其绝对值表示阻塞队列中等待该资源的进程数。
    
    PV操作是实现进程同步与互斥的常用方法。PV操作是低级通信原语，执行期间不可分割。P表示申请资源，V表示释放资源。
   
    P操作定义：S:=S-1,若S>=0, 则执行P操作的进程继续执行；若S<0, 则置该进程为阻塞状态（无可用资源），并将其插入阻塞队列。
    ```
    Procedure P (Var S:Semaphore);
        Begin
            S:=S-1;
            IF S< 0 then W (s);
        END;
    ```
    V操作定义：S:=S+1, 若S>0, 则执行V操作的进程继续执行；若S<=0,则从阻塞状态唤醒一个进程，并将其插入就像队列，然后执行V操作的进程继续执行。
    ``` 
    Procedure P （Var S:Semaphore)
        Begin
            S:=S+1;
            IF S <=0 then R （S）
        End
    ```
* 利用PV操作实现进程互斥

    令信号量mutex的初始值为1，当进入临界区时执行P操作，退出临界区时执行V操作。
    ```text
    P （mutex）
    临界区
    V (mutex)
    ```
* 利用PV操作实现进程同步

    进程同步是由与进程间合作引起的相互制约的问题，要实现进程的同步可用一个信号量与消息联系起来。当信号量的值为0时表示希望的消息为产生，
    当信号量非0时表示希望的消息已经存在。假定用信号量S表示某条消息，进程可以通过调用P操作测试消息是否到达，调用V操作通知消息已到达。
    
    生产者消费者
    ```text
     生产者
    Loop
    生产一个产品 next;
    P（Bufempty）;
    Next 产品存缓冲区；
    V (Buffull);
    endloop
    消费者
    Loop
    P(Buffull);
    V(BUfempty);
    从缓冲区取出产品；
    使用产品；
    endloop;
    ```
    其中信号量Bufempty和buffull分别表示缓冲区中的空单元数据和非空单元数，他们的初始值分别为1和0；
    
#### 进程通信和管程
* 进程通信

    通信（communication）是指进程间的信息交换。根据通信内容分为控制信息的交换和数据的交换。控制信息的交换称为低级通信，
    进程通的同步和互斥是通过信号量来实现通信的，属于低级信息。数据的交换称为高级通信。高级通信的类型有共享存储系统和消息传递系统
    和管道通信。高级通信的方式有直接通信和间接通信。
    
* 管程

    汉森和霍尔提出的一种同步机制。
    
    管程是由一些共享数据、一组能为并发进程执的作用的共享数据上的操作的集合、初始代码以及存取权组成的，也即共享数据及在其上
    操作的一组过程就构成了管程。进程可以在任何需要资源的时候调用管程，且在任一个时刻最多只有一个进程能够真正地进入管程，其他的
    只能等待。管程提供了一种可以允许多进程安全有效地共享抽象数据类型的机制。
    ```text
    Type<管程名>=monitor
          <管程变量说明>；
          define<(能够被其他模块引用)过程名列表>;
          procedure<过程名》（<形式参数表》）
              begin
                  <过程体>;
              end;
          ...
          procedure<过程名》（<形式参数表》）
                begin
                    <过程体>;
                end;
          begin
          <管程的局部数据初始语句>;
    End.
    ```  
        
#### 进程调度与死锁
* 进程调度
    
    进度调度即处理器调取（又称上下文转换） ，她主要功能是确定把处理器在什么时候分配给哪一个进程。在某些操作系统中，一个作业
    从提交到完成需要经历高、中、低三级调度。
    
* 调度方式和算法
    
   调度方式:当有更高优先级的进程到来时如何分配CPU.有可剥夺和不可剥夺。
   
   调度算法:先来先服务、时间片轮转（round robin)、优先级调度和多级反馈调度算法。
   
* 死锁
    
    死锁是指两个以上的进程互相都因为请求对方已占有的资源，无限期地等待并无法继续运行下去的现象。
    死锁是系统的一种错误状态，它浪费系统资源，还是会导致系统崩溃，所以应该预防和避免死锁。
    
    死锁产生:资源竞争以及进程推进顺序非法。产生死锁的必要4个条件:互斥条件、请求保持条件、不可剥夺条件和环路条件。
    
    解决死锁策略：鸵鸟策略（不理睬策略）、预防策略（破坏死锁4个必要条件之一）、避免策略（精心地分配资源、动态地回避死锁）、
    检测与解除死锁（一旦发生死锁，系统不但能检测出、还能解除）。
 
#### 线程
    
   线程是进程的一个实体，是被系统独立分配和调度的基本单位。在引入线程的操作系统中，通常一个进程都有若干个线程。线程只拥有一些
   运行中必不可少的资源，它可与同属一个进程的其他线程共享所拥有的全部资源。线程具有许多传统进程所具有的特性，称为轻型进程（Light-Weight Process);
   称传统进程为重型进程（Heavy-Weight Process)。线程可以创建另一个线程，同一个进程中有个多个进程并发执行。线程具有就绪、阻塞、运行三种基本状态。
   

### 存储管理
   存储器是计算机系统的关键资源，是存放各种信息的主要场所。存储器的发展方向是告诉、大容量和小体积。存储管理的主要任务是如何提高主存的利用率、
   扩充主存以及对主存信息实时有效保护。存储管理的对象是主存储器（简称主存或者内存）
  
#### 存储管理概念
   存储组织的功能是在存储技术和cpu寻址技术许可的范围内组织合理的存储结构，是的各层次的存储器都能处于均衡的繁忙状态，其依据是访问速度匹配、容量要求和价格等
   
* 存储器结构
    
    寄存器-主存-外存
    
    寄存器-缓存-主存-外存
    
* 逻辑地址

    用户程序编译后，每个目标块以0为基地址进行顺序编址，它不是主存的真实地址，是相对基地址而言的。逻辑地址又称相对地址、程序地址或虚拟地址。
    
* 物理地址

    主存中各存储单元的地址，从统一的基地址进行的顺序编址，是主存中真实地址，可以寻址并实际存在。物理地址又称绝对地址。
    
* 存储空间

    逻辑地址空间（简称地址空间）是逻辑地址的集合，物理地址空间（又称存储空间）是物理地址的集合。
    
#### 地址重定位
   程序的逻辑地址被转换成主存的物理地址过程称为地址重定位。
   
* 重定位方式

    静态重定位:在程序执行之前进行地址重定位，即转入内存时重定位
    
    动态重定位:在程序执行期间，每次存储访问之前进行地址重定位
    
#### 存储管理的功能
   主存储器的分配和回收、 提高主存储器的利用率、 存储保护、主存扩充
   
#### 存储管理的方式
   分区存储管理、分页存储管理、分段存储管理、段页式存储管理和虚拟存储管理
   
### 设备管理
   设备管理任务：保证在多道程序环境下，当多个进程竞争使用设备时，按一定策略分配和管理各种设备，控制设备的各种操作，完成输入/输出设备
   与主存直接的数据交换。
   
   设备管理目标：提高设备利用率，为用户提供方便统一的界面
   
   设备管理主要功能：动态地掌握并记录设备的状态、设备分配和释放、缓冲区管理、实现物理输入/输出设备的操作、提供设备使用的用户接、设备的访问和控制
   、输入/输出缓冲和调度
   
#### 设备分类

* 使用特性分为存储设备、输入/输出设备、终端设备和脱机设备
* 资源分配角度分为独占设备、共享设备和虚拟设备
* 从属关系分为系统设备和用户设备
* 数据组织方式分为块设备（Block Device）和字符设备（Character Device）
* 传输速率分为低速、中速、高速设备
* 输入/输出对象分为人机通信设备、机机通信设备
* 是否可以交互分为非交互设备、交互设备

#### 设备管理的主要技术
   * 中断技术
   * DMA技术（Direct Memory Access,DMA）
   * 缓冲技术
   * 虚设备与SPOOLING(simultaneous perioheral operations online,外围设备联机)技术  

#### 设备管理软件
   * 中断处理程序
   * 设备驱动程序
   * 与设备无关的系统软件
   * 与用户I/O软件
   
#### 数据传输方式
   设备的主要工作之一是控制设备和内存或者CPU之间的数据传送。
   * 程序控制方式
   * 中断方式
   * 直接存储访问方式
   * 通道方式
   
#### 磁盘调度算法
   磁盘是可供多个进程共享的设备。磁盘调度是使各进程对磁盘的平均访问时间最小。
   
   调度算法
   * 先来先服务（first-come first-served,FCFS）
   * 最短寻道时间优先（Shortest Seek Time First,SSTF）
   * 扫描算法（SCAN）
   
### 文件管理 
文件（File）是具有符号名的、在逻辑上具有完整意义的一组相关信息项的集合。 

文件名的格式和长度因系统而异，操作系统根据文件名对其进行控制和管理。

文件管理系统是操作系统对文件进行统一管理的一组软件和相关数据的集合，称为文件系统。

文件系统功能：按名存取、统一用户接口、并发访问和控制、安全性控制、优化性能以及差错恢复。

文件类型
* 按文件性质和用途分为系统文件、库文件和用户文件
* 安全属性分为只读文件、读写文件、可执行文件和不保护文件
* 组织形式分为普通文件、目录文文件、设备文件（特殊文件）
* 保存期限分为临时文件、档案文件、永久文件
* 信息流向分为输入文件、输出文件、输入/输出文件

文件的结构和组织

   文件的结构指文件的组织形式。从用户角度看到的文件组织形式称为文件的逻辑结构，从实现的角度看文件在存储设备上的存放方式，称为文件的物理结构。

   文件逻辑结构分为：记录文件和无结构的字符流文件。

   物理逻辑结构分为：连续结构、链接结构、索引结构、多个物理块的索引表。

文件访问方法
* 顺序访问，按照信息顺序依次读写
* 随机访问，按照任意次序随机读写。

文件存储设备空闲空间管理方法
* 位图法
* 索引法
* 连接法

文件控制块
    
   文件控制块是系统为每个文件设置的用于描述和控制文件的数据结构，它是文件存在的唯一标志。（File Control Block,FCB）
    
   FCB包含信息
    * 基本信息
    * 位置信息
    * 存取控制信息
    * 使用信息
    
文件目录

   文件控制块的有序集合。目录结构分为一级、二级和多级目录结构。
   
文件使用
   
   工作目录称为当前目录，用户可以随意设置任意一个目录为工作目录。
   
   文件安全管理措施:系统级、用户级、目录级和文件级。
   
### 作业管理
   作业是系统为完成一个用户的计算任务（或一次事务处理）所做的工作总和。
   
   作业组成
   * 程序
   * 数据
   * 作业说明
   
#### 作业管理和作业控制
   作业管理程序是系统中用来控制作业进入、执行和撤销
   
   作业控制采用脱机和联机控制。
   
   作业控制块JCB记录与该作业相关的各种信息登记表。作业存在的唯一标识。
   
   JCB组成
   * 用户
   * 作业名
   * 状态标志
   
   作业后备队列，在输入井中，通常将作业控制块排成一个或多个队列。
   
#### 作业状态及其转换
   作业有4种状态提交、后备、执行和完成。
    
   作业状态转换：![Image text](https://github.com/DEAN-Lee/img-rep/blob/master/system_architecture/2020-11-24_19-40-52.png)

   作业调度算法
   * 先来先服务
   * 短作业优先
   * 响应比高优先
   * 优先级调度
   * 均衡调度算法
   
   衡量作业调度算法性能
   * 平均周转时间
   * 平均带权周转时间
   
### 网络操作系统
   网络操作系统分类集中模式、客户机/服务器模式和对等模式（peer-to-peer）   
   
   
