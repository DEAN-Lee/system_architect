# 系统架构师设计教程(清华)-数据库系统基础
数据库（DataBase,DB）是指长期存储在计算机内的，有组织的、可共享的数据集合。

数据库系统（DataBase System,DBS）从广义上来讲是由数据库、硬件、软件和人员组成，管理对象的数据。

数据库管理系统（DataBase Management System,DBMS）是一种操纵和管理数据库的大型软件，用于建立、使用和维护数据库。主要功能有数据定义、
数据库操作、数据库运行管理、数据组织、存储和管理、数据库管理和维护以及其他功能。

DBMS分为三类
* 关系数据库系统（Relation DataBase System,RDBS）
* 面向对象的数据库系统 （Object-Oriented DataBase system,OODBS）
* 对象关系数据库系统(Object-Oriented Relation DataBase system,ORDBS)

数据库系统三级模式
* 外模式：外模式也称为子模式或用户模式，它是用户能够看见和使用的局部数据的逻辑结构和特征的描述，是用户的数据视图，是与某一应用有关的数据的逻辑表示。
* 逻辑模式(概念模式)：是对数据库中全体数据的逻辑结构和特征的描述、是对型的描述，不涉及具具体值、模式是相对稳定的，是数据库系统模式结构的中间层，既不涉及数据库存储细节和硬件环境，也不涉及具体的应用程序、所使用的应用开发工具和高级程序设计语言。
* 内模式：内模式也称为存储模式，它是数据库在物理存储器上具体实现的描述，是数据在数据库内部的表示方法，也是数据物理结构和存储方式的描述。一个数据库只有一种内模式。

三级模式映射
* 外模式/模式之间的映射
* 模式/内模式之间的映射

模式映射意义保证数据库中的数据具有较高的逻辑独立性和物理独立性。

数据库系统体系结构

   ![Image text](https://raw.githubusercontent.com/DEAN-Lee/img-rep/master/system_architecture/Snipaste_2020-11-26_18-55-40.png)

## 关系数据库基础
### 数据库的结构和模式
数据库结构基础是数据模型，是用来描述数据的一组概念和定义。

数据模型三要素
* 数据结构
* 数据操作
* 数据的约束条件

常用数据模型
* 概念数据模型
* 基本数据模型
* 面向对象模型

关系数据模型组成
* 关系数据结构
* 关系操作集合
* 关系完整性约束

### 实体-联系（E-R）模型
概念模型中常用方法实体-联系方法，简称E-R方法。主要概念有实体、联系和属性。该方法直接从现实世界中抽象出实体和实体间的联系。如下图

   ![Image text](https://raw.githubusercontent.com/DEAN-Lee/img-rep/master/system_architecture/Snipaste_2020-11-27_17-30-59.png)

E-R图只要构件:

   ![Image text](https://raw.githubusercontent.com/DEAN-Lee/img-rep/master/system_architecture/Snipaste_2020-11-27_17-31-20.png)


### 数据的规范化
规范化理论研究的是关系模式中各属性之间的依赖关系以及其对关系模式性能的影响。

数据库范式，又称为数据库规范化，用于保证数据库之间的关系合理，减少数据库中的数据冗余，消除操作带来的异常，增进数据的一致性。
常用范式有：1NF、2NF、3NF、BCNF、4NF、5NF、6NF 等等.
范式过高虽然具有对数据关系有更好的约束性，但是也会导致表之间的关系更加繁琐，从而导致每次操作的表会变多，数据库性能下降。
通常，在我的设计中，最高也就遵循到 BCNF，普遍还是 3NF。
* 第一范式1NF：属于第一范式关系的所有属性都不可再分，即数据项不可分。一范式强调数据表的原子性，是其他范式的基础

* 第二范式2NF ：若某关系R属于第一范式，且每一个非主属性完全函数依赖于任何一个候选码，则关系R属于第二范式。第二范式是指每个表必须有一个（有且仅有一个）
数据项作为关键字或主键（primary key），其他数据项与关键字或者主键一一对应，即其他数据项完全依赖于关键字或主键。
        
    码：关系中的某个或者某几个属性的集合，用于唯一地标识每一条数据（这里的每一条数据就是数据库中的每一条记录）。。
    候选码：若关系中的某一属性组的值能唯一地标识一个元组，而其子集不能，则称该属性组为候选码。
    
    主码：在一个表的关系中，可以存在多个关系集合用于唯一确定一条记录，这些多个集合就称为候选码，也称为候选键。候选码可以存在多个，每一个候选码都可以唯一地确定一条记录。
    若一个关系中有多个候选码，则选定其中一个为主码，主码和候选码统称为码，主键。
    
    外码：即外键。
    
    属性：属性就是我们在表中定义的每一个列。
        
    主属性： 所有候选码的属性称为主属性。不包含在任何候选码中的属性称为非主属性或非码属性。
    
    函数依赖：函数依赖是一种最重要、最基本的数据依赖。在数学上的解释是：y = f(x)，输入一个 X，可以得到一个确定的 Y。
    对应到一个表上就是，在一个属性（属性组）X 确定的情况下，必定能够确定属性 Y 的值，这就能够称作 Y 函数依赖于 X，写作 X -> Y​ 。
    依赖分为完全依赖、部分依赖和传递函数依赖
     
    - 平凡函数依赖于非平凡函数依赖：若 x→y ，但y不是x的子集，则称 x→y 是非平凡的函数依赖。 若 x→y ，但y是x的子集，则称 x→y 是平凡的函数依赖  
    - 完全依赖：若 x → y，且 x 的任何一个真子集 x'，都不可能 x' → y，则称 y 对 x 完全函数依赖。记作：X →F y
    - 部分依赖：若 x → y，但 y 不完全函数依赖于 x，则称 y 对 x 部分函数依赖。记作：x→P y
    - 传递函数依赖：如果 Z 函数依赖于 Y，Y 函数依赖于 X，并且 X 不函数依赖于 Y，那么我们就说 Z 传递函数依赖于 X。 记作：X ->T Z
    - 直接依赖：若 x → y，y → z。且 y → x，即 y ←→ x。 则 z 直接依赖为 x。
    
* 第三范式3NF：只要表中存在非主属性对码的传递函数依赖，则不满足 3NF 的要求。所以对于 3NF 来说，就是在 2NF 的基础上，消除非主属性对码的传递函数依赖。

* 巴克斯范式 BCNF：不存在主属性对于码的部分函数依赖和传递函数依赖，那么即符合 BCNF。在 3NF 的基础上，消除主属性对码的部分函数依赖和传递函数依赖。

关系模型的规范化是指把一个低一级的范式的关系模式转换成若干个高一级范式的关系模式的过程。

### 事务管理
事务是一个操作序列，这些操作要么都成功，要么都不做，事务是数据库环境中不可分割的逻辑单位。

事务的四个特性：原子性（atomicity)、一致性（consistency)、隔离性（isolation）和持久性（durability）.也称为事务的ACID特性。

SQL语言中事务定义有三条：BEGIN TRANSACTION 事务开始、COMMIT 事务提交和ROLLBAK事务回滚。

### 并发控制
并发操作是指在多用户共享的系统中，用户可能同时对同一个数据进行操作。并发操作带来的问题是数据的不一致，主要有丢失更新、不可重复读和脏读数据。
其主要原因是事务的并发操作破坏了事务的隔离性。DBMS的并发控制子系统负责协调并发事务的执行，保证数据库的完整性不受破坏，避免用户得到不正确的数据。

并发控制的主要技术是封锁。封锁类型有排他锁（X锁或写锁）和共享锁（S锁或读锁）。并发控制还与三级封锁协议、活锁与死锁、并发调度的可串行性、两段封锁协议、封锁的粒度、事务的嵌套等有关

### 数据库的备份和恢复
数据库备份：保护数据库的关键技术在于建立冗余数据。建立冗余数据方法是进行数据转储和建立日文件。数据转储分为静态转储和动态转储、海量转储和增量转储。

如何在系统出现故障后能够及时使数据库恢复到故障前的正确状态，就是数据库恢复技术。

数据库的4类故障是事务故障、系统故障、介质故障和计算机病毒。

事务故障恢复操作：事务撤销（UNDO）和事务重做（REDO）.

介质故障DBA介入、装入数据库的副本和日志文件副本，再由系统执行撤销和重做操作。

一般数据库系统中，两种方法同时采用。为了避免磁盘介质出现故障影响数据库性能。DBMS会提供数据库镜像功能用于数据库恢复，数据库镜像是通过
复制数据库实现，但频繁地复制数据会降低系统的运行效率，因此时间应用中往往只针对关键数据和日志文件镜像。

## 关系数据库设计
数据库设计是指给定应用环境、构造最优的数据库，建立数据库及其应用系统，使之能有效地存储数据，满足各种用户需求。数据库设计
包括结构特性的设计和行为特性的设计。

### 数据库设计特点
* 从数据结构即数据模型开始，并以数据模型为核心展开，主要特点。
* 静态结构设计和动态行为设计分离
* 试探性
* 反复性和多步性

### 数据库设计方法
数据库设计方法分类：
* 直观设计方法
* 规范设计方法
* 计算机辅助设计方法
* 自动化设计方法

常用设计法：
* 基于3NF的设计方法
* 基于实体联系（E-R）模型的数据库设计法
* 基于视图概念的数据库设计法
* 面向对象的关系数据库设计法
* 计算机辅助数据库设计法
* 敏捷数据库设计法

### 数据库设计步骤
数据库设计阶段：
* 需求分析：详细调研了解下现行系统，在过程收集新目标的基础数据以及处理方法。在用户角度去分析，逐步了解用户的真是目标，包括数据需求
和围绕这些数据的业务处理过程。分析过程应该自顶向下，逐步分解的方法分析系统。分析结果用数据流图（Data Flow Diagram,DFD）进行图形化的描述，
并用规范表格分析结果和描述补充，最后形成需求说明书。
* 概念结构设计:在需求分析基础上，按照信息需求，对信息加以分类、聚集和概括，建立信息模型，并按照数据库管理系统软件，转换为数据的逻辑结构
在按照软硬件软件，最终实现数据的合理存储。这过程也称为数据建模。

    数据库概念结构设计的策略：自顶向下、自底向上、逐步扩张、混合策略。最常用的是自底向上。
    
    设计数据库概念模型方法是实体-联系法，即E-R方法。
    
    使用E-R方法设计数据库概念结构分为三步：设计局部E-R模型、设计全全局E-R模型以及全局E-R模型优化。

* 逻辑结构设计: 在概念结构设计的基础上进行数据模型设计，可以是层次、网状模型和关系模型。主要任务是确定数据模型、将E-R图转换为指定
数据模型、确定完整性约束、确定用户视图

* 物理结构设计:数据库在物理设备上的存储结构与存取方法称为数据库的物理结构。数据库的物理机构设计对已经确定的数据库逻辑结构，利用DBMS
所提供的方法、技术，以比较优的存储结构和数据存储路径、合理的数据存放位置以及存储分配，设计一个搞笑的、可实现的数据物理结构。
物理结构设计的主要工作有存储记录的格式设计、存储结构设计、存取方法设计和确定系统配置

* 应用程序设计:主要工作选择设计方法、指定开发计划、选择系统架构、设计安全性策略。

    设计方法有结构化设计方法和面向对象设计方法
    
    安全性策略指硬件平台、操作系统、数据库系统、网络已经应用系统的安全。

* 运行维护: 主要工作数据库转储和恢复、安全性和完整性、数据库性能监督、分析和改造、数据库重组和重构。

    ![Image text](https://raw.githubusercontent.com/DEAN-Lee/img-rep/master/system_architecture/Snipaste_2020-11-28_19-12-28.png)
    
## 分布式数据库系统（Distributed Database System,DDBs）
满足分布性、逻辑相关性、场地透明性和场地自治性的数据库系统成为完全分布式数据库系统。

分布式数据库系统特点是数据的集中控制、数据的独立性、数据冗余可控性、场地自治性和存取有效性。

### 分布式数据库的体系结构
我国《分布式数据库系统标准》就分布式数据库抽象分为4层，各层之间有响应映射。
* 全局外层
* 全局概念层
* 局部概念层
* 局部内层

  ![Image text](https://raw.githubusercontent.com/DEAN-Lee/img-rep/master/system_architecture/Snipaste_2020-11-30_19-30-12.png)

### 分布式数据库系统应用
分布式计算、Internet应用、数据仓库、数据复制以及全球互联网查询等。

## 商业智能
商业智能（Business Intelligence,BI）是企业对商业数据的搜集、管理和分析的系统过程。目的是使企业的各级决策者获得知识或洞察力，帮助他们做出对
企业更有利的决策。它是数据仓库、联机分析处理（Online Analytical Processing,OLAP）和数据挖局等相关技术走向商业应用后形成的一种应用技术。

商业智能系统将原始业务数据转换为企业决策者信息的过程。主要包括数据预处理、建立数据仓库、数据分析以及数据展现。数据仓库、联机分析处理和数据挖掘
技术是商业智能的三大组成部分。

### 数据仓库
数据仓库（Data Warehouse) 是一个面向主体（Subject Oriented）、集成的(Integrate)、相对稳定(Non-Volatile)、且随时间变化(Time Variant)的数据集合，支持管理部门的决策过程。

数据仓库特性面向主题、集成的、非易失的、事变的。

数据仓库采用三层结构，底层数据仓库服务器、中间层是OLAP服务器、顶层是前端工具。如下图展示

  ![Image text](https://raw.githubusercontent.com/DEAN-Lee/img-rep/master/system_architecture/Snipaste_2020-11-30_19-49-24.png)

#### 数据仓库实现方法
数据仓库实时步骤
1. 规划
2. 需求调研
3. 问题分析
3. 数据的抽取清洗集成装载
3. 数据仓库设计
3. 数据仓库管理
3. 分析报表查询
3. 数据仓库性能优化
3. 数据仓库不是发布

实现方法自顶向下方法，自底向上方法以及二者混合方法。推荐方法是以递增、进化的发发发实现。如下图

  ![Image text](https://raw.githubusercontent.com/DEAN-Lee/img-rep/master/system_architecture/Snipaste_2020-11-30_19-51-49.png)

### 多维分析海里数据分析器-OLAP
联机分析处理OLAP,提供切片、切块、下钻、上卷和旋转等多维分析与跨纬度分析功能。

OLAP系统架构主语基于关系数据库的ROLAP(Relational OLAP)、基于多维数据库MOLAP(Multidimensional OLAP)和基于混合数据组织的
HOLAP(Hybrid OLAP) 三种。

### 数据挖掘（data mining）
数据挖掘广义观点：数据挖掘是从存放在数据库、数据仓库中或者其他信息库中的大量数据中挖局有趣知识过程。

数据挖掘和传统数据分析本质区别：数据挖掘是在没有明确假设的前提下进行的挖掘信息、发现知识。数据挖掘到的信息具有先知行、有效和实用三个特点。

#### 数据挖掘的功能
目标发现隐含的，有意义的知识。主要功能分为五类：自动预测趋势和行为、关联分析、聚类、概念描述和偏差检测。

#### 数据挖掘技术
常用技术包括：关联分析、序列分析、分类分析、聚类分析、预测以及时间序列分析。

#### 数据挖掘过程
流程为：确定挖掘对象、准备数据、建立模型、数据挖掘、结果分析和知识应用。

### 数据挖掘应用
空间数据库挖掘、多媒体数据库挖掘、时序数据和序列数据的挖掘、文本数据库的挖掘、Web挖掘。

## 常见数据库管理系统
Oracle、IBM DB、 Sybase、Microsoft SQL Server










